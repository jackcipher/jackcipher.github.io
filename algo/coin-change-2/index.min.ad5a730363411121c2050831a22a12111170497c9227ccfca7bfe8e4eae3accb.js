(function(){const n=document.getElementById("algo-coin-change-2");if(!n)return;let e={coins:[],amount:0,history:[],stepIndex:-1,isPlaying:!1,timer:null};const t={inputCoins:n.querySelector("#inputCoins"),inputAmount:n.querySelector("#inputAmount"),btnLoad:n.querySelector("#btnLoad"),btnPrev:n.querySelector("#btnPrev"),btnNext:n.querySelector("#btnNext"),btnAuto:n.querySelector("#btnAuto"),speedRange:n.querySelector("#speedRange"),tableHead:n.querySelector("#dp-header-row"),tableBody:n.querySelector("#dp-body"),explainer:n.querySelector("#step-explainer"),valCoin:n.querySelector("#val-coin"),valJ:n.querySelector("#val-j"),valCalc:n.querySelector("#val-calc"),lines:n.querySelectorAll(".code-line")};function r(){const s=t.inputCoins.value.split(/[,，\s]+/).map(e=>parseInt(e.trim())).filter(e=>!(e!=e)&&e>0),n=parseInt(t.inputAmount.value);return s.length===0||n!=n||n<=0?(alert("请输入有效的硬币面额和正整数金额。"),!1):(e.coins=s,e.amount=Math.min(n,20),t.inputAmount.value=e.amount,!0)}function a(){if(i(),!r())return;e.history=[],e.stepIndex=-1;let n=new Array(e.amount+1).fill(0);n[0]=1;let t=[];t.push({label:"Init",data:[...n],type:"static"}),e.history.push({rows:JSON.parse(JSON.stringify(t)),phase:"init",activeCoin:null,activeJ:-1,explainer:"初始化: dp[0]=1 (金额0有一种凑法)",line:3});for(let s of e.coins){let o=[...n];t.push({label:`Coin ${s}`,data:o,type:"active"}),e.history.push({rows:JSON.parse(JSON.stringify(t)),phase:"coin-start",activeCoin:s,activeJ:-1,explainer:`开始处理硬币 ${s}。当前 DP 继承自上一轮。`,line:4});for(let o=s;o<=e.amount;o++)e.history.push({rows:JSON.parse(JSON.stringify(t)),phase:"calc-focus",activeCoin:s,activeJ:o,sourceJ:o-s,explainer:`计算 dp[${o}]。需要加上 dp[${o}-${s}] (即 dp[${o-s}])。`,line:7}),n[o]+=n[o-s],t[t.length-1].data[o]=n[o],e.history.push({rows:JSON.parse(JSON.stringify(t)),phase:"calc-update",activeCoin:s,activeJ:o,sourceJ:o-s,valNew:n[o],explainer:`dp[${o}] 更新为 ${n[o]}。`,line:7});t[t.length-1].type="static"}e.history.push({rows:JSON.parse(JSON.stringify(t)),phase:"done",activeCoin:null,activeJ:-1,explainer:`计算完成。最终结果: ${n[e.amount]}`,line:10}),e.stepIndex=0,s()}function c(e){if(!t.lines)return;if(t.lines.forEach(e=>e.classList.remove("active")),e){const t=n.querySelector(`#line-${e}`);t&&t.classList.add("active")}}function s(){if(!e.history.length)return;e.stepIndex<0&&(e.stepIndex=0),e.stepIndex>=e.history.length&&(e.stepIndex=e.history.length-1);const s=e.history[e.stepIndex];t.tableHead.innerHTML="<th>Coin \\ Amt</th>";for(let n=0;n<=e.amount;n++){const s=document.createElement("th");s.innerText=n,t.tableHead.appendChild(s)}t.tableBody.innerHTML="",s.rows.forEach((e,n)=>{const o=document.createElement("tr"),i=document.createElement("td");i.innerText=e.label,o.appendChild(i),e.data.forEach((t,i)=>{const a=document.createElement("td");a.innerText=t;const r=n===s.rows.length-1;r&&e.type==="active"&&(i===s.activeJ&&(s.phase==="calc-update"?a.classList.add("cell-updated"):s.phase==="calc-focus"&&a.classList.add("cell-target")),i===s.sourceJ&&s.phase.startsWith("calc")&&a.classList.add("cell-source")),o.appendChild(a)}),t.tableBody.appendChild(o)});const o=t.tableBody.lastElementChild;if(o){const e=n.querySelector(".dp-table-container");e&&(e.scrollTop=e.scrollHeight)}t.explainer.innerText=s.explainer||"",t.valCoin.innerText=s.activeCoin!==null?s.activeCoin:"-",t.valJ.innerText=s.activeJ>-1?s.activeJ:"-",c(s.line),t.btnPrev.disabled=e.stepIndex===0,t.btnNext.disabled=e.stepIndex===e.history.length-1,t.btnAuto.classList.toggle("secondary",!e.isPlaying),t.btnAuto.innerText=e.isPlaying?"暂停":"自动"}function o(t){e.stepIndex+=t,s(),e.stepIndex>=e.history.length-1&&i()}function l(){if(e.isPlaying)i();else{e.stepIndex>=e.history.length-1&&(e.stepIndex=-1),e.isPlaying=!0,s();let n=1600-parseInt(t.speedRange.value);e.timer=setInterval(()=>{o(1)},n)}}function i(){e.isPlaying=!1,clearInterval(e.timer),e.timer=null,s()}t.btnLoad&&t.btnLoad.addEventListener("click",a),t.btnPrev&&t.btnPrev.addEventListener("click",()=>o(-1)),t.btnNext&&t.btnNext.addEventListener("click",()=>o(1)),t.btnAuto&&t.btnAuto.addEventListener("click",l),a()})()