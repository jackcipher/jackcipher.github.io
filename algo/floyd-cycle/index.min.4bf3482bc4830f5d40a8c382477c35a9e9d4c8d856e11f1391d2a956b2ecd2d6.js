(function(){const l=document.getElementById("algo-floyd-cycle");if(!l)return;const h=l.querySelector("#floyd-canvas"),e=h.getContext("2d"),j=l.querySelector("#floyd-status"),r=l.querySelector("#floyd-step"),f=l.querySelector("#floyd-reset"),n=[{id:0,x:50,y:150,next:1},{id:1,x:130,y:150,next:2},{id:2,x:210,y:150,next:3},{id:3,x:290,y:150,next:4},{id:4,x:370,y:100,next:5},{id:5,x:450,y:100,next:6},{id:6,x:530,y:150,next:7},{id:7,x:450,y:200,next:8},{id:8,x:370,y:200,next:3}];let t=0,a=0,i=0,o=null,u=0;const s=18,y=10;function v(t,n,o,i){const r=10,d=o-t,u=i-n,a=Math.atan2(u,d),h=t+s*Math.cos(a),m=n+s*Math.sin(a),c=o-s*Math.cos(a),l=i-s*Math.sin(a);e.beginPath(),e.moveTo(h,m),e.lineTo(c,l),e.strokeStyle="#999",e.lineWidth=2,e.stroke(),e.beginPath(),e.moveTo(c,l),e.lineTo(c-r*Math.cos(a-Math.PI/6),l-r*Math.sin(a-Math.PI/6)),e.lineTo(c-r*Math.cos(a+Math.PI/6),l-r*Math.sin(a+Math.PI/6)),e.fillStyle="#999",e.fill()}function p(t){e.beginPath(),e.arc(t.x,t.y,s,0,2*Math.PI),e.fillStyle="#fff",e.fill(),e.strokeStyle="#333",e.lineWidth=2,e.stroke(),e.fillStyle="#333",e.font="14px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText(t.id,t.x,t.y)}function g(){const r=n.find(e=>e.id===t);r&&(e.beginPath(),e.arc(r.x,r.y,s+4,0,2*Math.PI),e.strokeStyle="#007bff",e.lineWidth=3,e.stroke(),e.fillStyle="#007bff",e.font="bold 12px Arial",e.fillText("Slow",r.x,r.y-s-15));const c=n.find(e=>e.id===a);if(c&&i===0){e.beginPath();const n=t===a?6:0;e.arc(c.x,c.y,s+8+n,0,2*Math.PI),e.strokeStyle="#ff4d4f",e.lineWidth=3,e.stroke(),e.fillStyle="#ff4d4f",e.fillText("Fast",c.x,c.y+s+20+n)}if(i===1&&o!==null){const t=n.find(e=>e.id===o);e.beginPath(),e.arc(t.x,t.y,s+8,0,2*Math.PI),e.strokeStyle="#52c41a",e.lineWidth=3,e.stroke(),e.fillStyle="#52c41a",e.fillText("Finder",t.x,t.y+s+20)}}function d(){e.clearRect(0,0,h.width,h.height),n.forEach(e=>{const t=n.find(t=>t.id===e.next);t&&v(e.x,e.y,t.x,t.y)}),n.forEach(p),g()}function c(e){j.innerHTML=e||`Step ${u}: Slow at ${t}, Fast at ${a}`}async function b(){if(r.disabled=!0,i===0){const s=n.find(e=>e.id===t).next;let e=n.find(e=>e.id===a).next;e=n.find(t=>t.id===e).next,t=s,a=e,u++,d(),t===a?(i=1,o=0,c(`<strong>相遇！</strong> Slow 和 Fast 在节点 ${t} 相遇。<br>进入第二阶段：Finder 从头出发，Slow 从相遇点出发，每次一步。`)):c(`寻找相遇点... Slow -> ${t}, Fast -> ${a}`)}else if(i===1){const e=t,s=o;if(t===o){i=2,c(`<strong>找到环入口！</strong> 节点 ${t} 即为环的起点。<br>算法演示结束。`),r.disabled=!0;return}const a=n.find(e=>e.id===t).next,l=n.find(e=>e.id===o).next;t=a,o=l,d(),t===o?(c(`<strong>找到环入口！</strong> Finder 和 Slow 在节点 ${t} 相遇。`),i=2,r.disabled=!0):c(`寻找环入口... Slow: ${e}->${t}, Finder: ${s}->${o}`)}i!==2&&(r.disabled=!1)}function m(){t=0,a=0,i=0,o=null,u=0,r.disabled=!1,d(),c("已重置。初始状态：Slow 和 Fast 都在头节点 0。")}r.addEventListener("click",b),f.addEventListener("click",m),m()})()